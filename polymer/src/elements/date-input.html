<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-date-picker/paper-date-picker.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<link rel="import" href="../behaviors/utils.html">
<link rel="import" href="../behaviors/date.html">

<dom-module id="date-input">

  <template>
    <style include="button-styles iron-flex iron-flex-reverse">
      :host {
        display: block;

        --default-primary-color: var(--theme-primary-color);

        --paper-dialog: {
          width: auto;
          max-width: none !important; /* :( */
          max-height: none !important; /* :( */

          & > * {
            margin: 0;
          }
        };
      }

      .buttons {
        padding: 10px;
      }
    </style>

    <paper-dialog
       id="modal"
       class="paper-date-picker-dialog"
       horizontal-align="right"
       vertical-align="bottom">

     <paper-date-picker
       id="picker"
       date="{{_date}}"
       force-narrow>
     </paper-date-picker>

     <div class="buttons layout horizontal-reverse">
       <paper-button
           class="btn-primary"
           on-tap="_select">
         Select
       </paper-button>
       <paper-button
           on-tap="_close">
         Cancel
       </paper-button>
     </div>
   </paper-dialog>

   <paper-input
     class="item validate"
     id="input"
     label="[[label]]"
     on-tap="_openModal"
     value="{{value}}"
     required>
   </paper-input>
 </template>

 <script>
   Polymer({
     id: 'date-input',

     properties: {
       date: Object,

       value: {
         type: String,
         value: '',
         notify: true,
       },

       needsValidation: {
         type: String,
         value: '',
         notify: true,
       },
     },

     observers: [
       '_validate(needsValidation)',
     ],

     behaviors: [
       App.Behaviors.UtilsBehavior,
     ],

     _openModal: function () {
       this.$$('#modal').open();
     },

     _close: function () {
       this.set('opened', false);
     },

     _select: function () {
       this.value = moment(this._date).format('YYYY-MM-DD');
       this.$$('#modal').close();
     },

     _validate: function (validate) {
       if (validate) {
         this._fieldsAreValid();
       }

      //  Reset this value in the parent.
      this.needsValidation = '';
     }
   });
 </script>
</dom-module>
