<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../bower_components/paper-menu/paper-submenu.html">
<link rel="import" href="../../../bower_components/app-route/app-route.html">
<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/av-icons.html">
<link rel="import" href="../../../bower_components/iron-location/iron-query-params.html">
<link rel="import" href="../../../bower_components/app-localize-behavior/app-localize-behavior.html">

<link rel="import" href="../../behaviors/utils.html">
<link rel="import" href="../../behaviors/page-nav.html">
<link rel="import" href="../../behaviors/routing.html">
<link rel="import" href="../../behaviors/localize.html">
<link rel="import" href="../../redux/store.html">
<link rel="import" href="../etools-prp-permissions.html">

<link rel="import" href="../../styles/page-nav.html">

<dom-module id="cluster-reporting-nav">
  <template>
    <style include="page-nav-styles">
      :host {
        --paper-item-selected: {
          color: var(--theme-primary-color);
          background: var(--theme-selected-item-background-color);
        };
      }

    </style>

    <etools-prp-permissions
        permissions="{{permissions}}">
    </etools-prp-permissions>

    <app-route route="{{route}}"></app-route>

    <iron-query-params
        params-string="{{partnerQuery}}"
        params-object="{{partnerQueryParams}}">
    </iron-query-params>


    <paper-menu
        id="menu"
        selected="{{selected}}"
        attr-for-selected="name"
        selectable=".selectable"
        key-event-target="null">

        <paper-item name="dashboard" class="selectable">
          <a href="[[buildUrl(_baseUrlCluster, '/dashboard')]]">
            <span><iron-icon icon="view-quilt" role="presentation"></iron-icon>[[localize('dashboard')]]</span>
          </a>
        </paper-item>

        <div name="response-parameters" class="selectable">
          <paper-submenu>
            <paper-item class="menu-trigger">
              <a href="[[buildUrl(_baseUrlCluster, 'response-parameters')]]">
              <span><iron-icon icon="compare-arrows" role="presentation"></iron-icon>[[localize('response_parameters')]]</span>
              </a>
            </paper-item>
            <paper-menu class="menu-content">
              <paper-item name="response-parameters" id="clustersSubmenu" class$="[[clustersSelected]]">
                <a href="[[buildUrl(_baseUrlCluster, 'response-parameters/clusters')]]">[[localize('clusters')]]</a>
              </paper-item>
              <paper-item name="response-parameters" id="partnersSubmenu" class$="[[partnersSelected]]">
                <a href="[[buildUrl(_baseUrlCluster, 'response-parameters/partners')]]">[[localize('partners')]]</a>
              </a>
            </paper-menu>
          </paper-submenu>
        </div>

        <template
            is="dom-if"
            if="[[permissions.viewPlannedAction]]"
            restamp="true">
          <paper-item name="planned-action" class="selectable">
            <a href="[[buildUrl(_baseUrlCluster, '/planned-action/')]]">
              <span><iron-icon icon="av:playlist-add" role="presentation"></iron-icon>[[localize('my_planned_action')]]</span>
            </a>
          </paper-item>
        </template>

        <paper-item name="results" class="selectable">
          <a href="[[buildUrl(_baseUrlCluster, '/results')]]?[[partnerQuery]]">
            <span><iron-icon icon="trending-up" role="presentation"></iron-icon>[[localize('reporting_results')]]</span>
          </a>
        </paper-item>

        <paper-item name="analysis" class="selectable">
          <a href="[[buildUrl(_baseUrlCluster, '/analysis')]]?[[partnerQuery]]">
            <span><iron-icon icon="av:equalizer" role="presentation"></iron-icon>[[localize('analysis')]]</span>
          </a>
        </paper-item>
  </template>

  <script>
    Polymer({
      is: 'cluster-reporting-nav',

      behaviors: [
        App.Behaviors.UtilsBehavior,
        App.Behaviors.PageNavBehavior,
        App.Behaviors.ReduxBehavior,
        App.Behaviors.RoutingBehavior,
        App.Behaviors.LocalizeBehavior,
        Polymer.AppLocalizeBehavior,
      ],

      properties: {
        clustersSelected: String,
        partnersSelected: String,
        permissions: Object,
        partnerQuery: String,

        partner: {
          type: Object,
          statePath: 'partner.current',
        },

        partnerQueryParams: {
          type: Object,
          computed: '_computePartnerQueryParams(partner)',
        },
      },

      observers: [
        '_routeChanged(route)',
      ],

      //Shows the submenu item selected upon initial load.
      _routeChanged: function() {
        if (this.route.path.indexOf('partners') >= 0) {
          this.partnersSelected = 'iron-selected';
          this.clustersSelected = '';
        } else {
          this.clustersSelected = 'iron-selected';
          this.partnersSelected = '';
        }
      },

      _computePartnerQueryParams: function (partner) {
        return {
          partner: partner.id,
        };
      },
    });
  </script>
</dom-module>
